<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="user-scalable=no">
    <title>货卡之家-文章编辑页</title>
    <meta name="description" content="">
    <meta name="keywords" content="">
    <link rel="stylesheet" type="text/css" href="/style/layer_mobile/need/layer.css">
    <link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <script src="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="/style/index/js/jquery.mobile-events.min.js"></script>
    <link rel="stylesheet" type="text/css" href="/style/index/css/style.css">
    <link rel="stylesheet" type="text/css" href="/style/index/css/usual.css">
    <link rel="stylesheet" type="text/css" href="/style/index/css/all.css">
</head>

<body>
    <!-- loding -->
    <div class="loading">
        <div class="pic"></div>
    </div>
    <div style="width:100%;margin: 0 auto;">
        
        <div class="publish-article-title">
            <div class="title-tips">
                <h2>帖子标题</h2></div>
            <input type="text" id="title" name="title" class="w100" placeholder="文章标题" style="width: 100%">
        </div>
        <div class="publish-article-content">
            <div class="title-tips">
                <h2>正文<h2>
            </div>
            <input type="hidden" id="target">
            <div class="article-content" id="content">
            </div>
            <div class="footer-btn g-image-upload-box overflow_hidden">
                <div class="upload-button publish-article-btn">
                    <span class="upload"><i class="upload-img"></i></span>
                    <input class="input-file" id="imageUpload" type="file" name="fileInput" accept="image/*" style="position:absolute;left:0;opacity:0;width:100%;border:none;">
                </div>
                <!-- <div class="publish-article-btn">
                    <span class=""><i class="upload-emoji"></i></span>   
                </div> -->
            </div>
        </div>
    </div>
    <div class="container-fluid">
        <div class="editor_span row">
            <h2 class="col-xs-12" style="color:#545454;">请选择发帖板块</h2>
            <ul class="col-xs-12 overflow_hidden" style="padding: 10px 0;">
                <li class="editor_span_item editor_active" data-code="0"><span>卡友生活</span></li>
                <li class="editor_span_item" data-code="1"><span>卡友经验</span></li>
                <li class="editor_span_item" data-code="2"><span>卡友求助</span></li>
                <li class="editor_span_item" data-code="3"><span>自由贸易</span></li>
                <li class="editor_span_item" data-code="4"><span>灌水区</span></li>
            </ul>
        </div>
        <div class="editor_button row">
            <input id="submit" class="btn btn-default col-xs-push-9 col-xs-3" type="submit" value="发帖">
        </div>   

    </div>
    <!-- menu -->
    <div id="header" class="header">
        <?=include('menu.html')?>
    </div>
</body>

</html>
<script type="text/javascript" src="/style/layer_mobile/layer.js"></script>
<script type="text/javascript" src="/style/index/js/all.js"></script>
<script type="text/javascript" src="/style/index/js/comment.js"></script>
<script type="text/javascript" src="/style/index/js/artEditor_index.js"></script>
<script type="text/javascript">
$('#content').artEditor({
    imgTar: '#imageUpload',
    limitSize: 5, // 兆
    showServer: true,
    uploadUrl: "<?=site_url('home/artEditor_img_upload')?>",
    data: {},
    uploadField: 'image',
    placeholader: '<p>请输入文章正文内容</p>',
    validHtml: ["br"],
    uploadSuccess: function(res) {
        // return img url
        return res.path;
    },
    uploadError: function(res) {
        // something error
        console.log(res);
    }
});

//提交发布
$('#submit').on('tap', function(event) {
    event.preventDefault();
    /* Act on the event */
    //alert($('#content').getValue());return;
    $.post("<?=site_url('home/add_article/do')?>", {title:$('input[name="title"]').val(), content: $('#content').getValue(), type:$('.editor_active').eq(0).attr('data-code')}, function(data, textStatus, xhr) {
        /*optional stuff to do after success */
        if(data.code == 200){
            alert('发布成功！');
            location.href='<?=base_url()?>';
        }else{
            alert(data.message);
        }
    }, 'json');
});
</script>